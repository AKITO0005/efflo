<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>efflo. - Check Mode</title>
  <style>
    /* --- 1. フォントと基本設定 (LPと統一) --- */
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;800&family=Zen+Kaku+Gothic+New:wght@400;700;900&family=Shippori+Mincho:wght@700&display=swap');

    :root {
      --c-bg: #F9F7F2; /* Milky Cream */
      --c-text: #1A1A2E; /* Ink Black */
      --c-accent: #304FFE; /* Electric Blue */
      --c-pink: #FF2E93; /* Hyper Pink */
      --c-card: #ffffff;
    }

    body {
      font-family: 'Outfit', 'Zen Kaku Gothic New', sans-serif;
      background-color: var(--c-bg);
      color: var(--c-text);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      line-height: 1.8;
    }

    /* --- 2. ヘッダー & ナビゲーション (LPと統一) --- */
    header {
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 100;
      background: rgba(249, 247, 242, 0.9);
      backdrop-filter: blur(10px);
      box-sizing: border-box;
    }

    .logo {
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: -0.05em;
      cursor: pointer;
      text-decoration: none;
      color: var(--c-text);
      transition: transform 0.3s ease;
    }
    
    .logo:hover { transform: scale(1.05); }
    .logo-dot { color: var(--c-pink); }

    /* ハンバーガーメニュー */
    .hamburger {
      cursor: pointer;
      z-index: 200;
      width: 30px;
      height: 20px;
      position: relative;
    }

    .hamburger span {
      display: block;
      position: absolute;
      height: 3px;
      width: 100%;
      background: var(--c-accent);
      border-radius: 9px;
      opacity: 1;
      left: 0;
      transform: rotate(0deg);
      transition: .25s ease-in-out;
    }

    .hamburger span:nth-child(1) { top: 0px; }
    .hamburger span:nth-child(2) { top: 9px; }
    .hamburger span:nth-child(3) { top: 18px; }

    .hamburger.open span:nth-child(1) { top: 9px; transform: rotate(135deg); }
    .hamburger.open span:nth-child(2) { opacity: 0; left: -60px; }
    .hamburger.open span:nth-child(3) { top: 9px; transform: rotate(-135deg); }

    /* モバイルメニューオーバーレイ */
    .menu-overlay {
      position: fixed;
      top: 0;
      right: -100%;
      width: 100%; 
      height: 100vh;
      background: var(--c-bg);
      z-index: 150;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: right 0.4s cubic-bezier(0.77, 0, 0.175, 1);
    }

    .menu-overlay.open { right: 0; }

    .menu-link {
      font-size: 2rem;
      font-weight: 800;
      color: var(--c-accent);
      text-decoration: none;
      margin: 20px 0;
      transition: color 0.3s;
    }
    .menu-link:hover { color: var(--c-pink); }

    /* --- 3. 診断ページのメインコンテンツ --- */
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 120px 20px 60px; /* ヘッダーの分だけ余白を空ける */
      text-align: center;
      animation: fadeInUp 0.8s ease;
    }

    .page-title {
      font-family: 'Zen Kaku Gothic New', sans-serif;
      font-weight: 900;
      font-size: 2.5rem;
      color: var(--c-accent);
      margin-bottom: 10px;
      letter-spacing: 0.05em;
    }

    .page-desc {
      font-size: 1rem;
      color: var(--c-text);
      opacity: 0.7;
      margin-bottom: 50px;
      font-weight: 700;
    }

    /* 質問カードのデザイン (LPの雰囲気に合わせる) */
    .question-card {
      background: #fff;
      padding: 30px;
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      margin-bottom: 30px;
      text-align: left;
      transition: transform 0.2s;
      border: 2px solid transparent;
    }

    .question-card:hover {
      transform: translateY(-2px);
      border-color: rgba(48, 79, 254, 0.1);
    }

    .question-text {
      font-weight: 800;
      font-size: 1.2rem;
      margin-bottom: 20px;
      color: var(--c-text);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .q-num {
      color: var(--c-pink);
      font-family: 'Outfit', sans-serif;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .options label {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 2px solid #eee;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 700;
      color: #555;
    }

    .options label:hover {
      border-color: var(--c-accent);
      background: #f0f4ff;
      color: var(--c-accent);
    }

    .options input {
      margin-right: 15px;
      accent-color: var(--c-accent);
      transform: scale(1.2);
    }

    .options input:checked + span {
      color: var(--c-accent);
    }
    .options label:has(input:checked) {
      border-color: var(--c-accent);
      background: #f0f4ff;
      color: var(--c-accent);
    }

    /* 送信ボタン (LPのボタンデザインに統一) */
    button#submit-btn {
      display: block;
      width: 100%;
      max-width: 300px;
      margin: 50px auto 0;
      padding: 18px 40px;
      font-size: 1.2rem;
      font-weight: 800;
      color: #fff;
      background: linear-gradient(45deg, var(--c-accent), var(--c-pink));
      border: none;
      border-radius: 99px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(48, 79, 254, 0.2);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button#submit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(48, 79, 254, 0.3);
      opacity: 1;
    }

    /* --- 4. 選択画面 (Selection Screen) --- */
    #selection-section {
      display: none;
      animation: fadeInUp 0.5s ease;
    }

    .selection-title {
      font-family: 'Zen Kaku Gothic New', sans-serif;
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--c-accent);
      margin-bottom: 30px;
    }

    /* Gridレイアウトで横並び */
    .candidates-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .candidate-card {
      background: #fff;
      border-radius: 24px;
      padding: 30px 20px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 3px solid transparent;
    }

    .candidate-card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      border-color: var(--c-text);
    }

    .candidate-img {
      width: 100%;
      max-width: 160px;
      height: auto;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.15));
      margin-bottom: 20px;
    }

    .candidate-name {
      font-family: 'Outfit', sans-serif;
      font-size: 1.8rem;
      font-weight: 800;
      line-height: 1;
      margin-bottom: 5px;
    }
    
    .candidate-jp {
      font-size: 1.1rem;
      font-weight: 900;
      color: var(--c-text);
    }

    /* --- 5. 最終結果画面 (Result Screen) --- */
    #result-section {
      display: none;
      text-align: center;
      background: transparent; 
      padding: 20px 0;
      animation: popIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .result-label {
      font-size: 1rem;
      color: var(--c-text);
      letter-spacing: 0.2em;
      margin-bottom: 20px;
      font-weight: 700;
      opacity: 0.5;
    }

    .final-image-container {
      width: 300px;
      height: 300px;
      margin: 0 auto 20px;
    }
    
    #final-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 20px 50px rgba(0,0,0,0.2));
    }

    .result-name-large {
      font-family: 'Outfit', sans-serif;
      font-size: 5rem;
      font-weight: 800;
      line-height: 0.9;
      margin: 10px 0 5px;
    }
    
    .result-jp-large {
      font-size: 1.8rem;
      font-weight: 900;
      color: var(--c-text);
      margin-bottom: 40px;
    }

    .result-desc {
      font-size: 1.1rem;
      line-height: 2;
      background: #fff;
      padding: 40px;
      border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.05);
      text-align: left;
      margin-bottom: 40px;
    }

    /* 戻るボタン */
    .back-btn {
      display: inline-block;
      padding: 12px 40px;
      border: 2px solid var(--c-text);
      background: transparent;
      border-radius: 99px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 800;
      color: var(--c-text);
      transition: all 0.2s;
      font-family: 'Outfit', sans-serif;
    }
    .back-btn:hover { 
      background: var(--c-text); 
      color: #fff;
    }

    /* アニメーション定義 */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes popIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    /* スマホ対応 */
    @media (max-width: 768px) {
      .page-title { font-size: 2rem; }
      .candidates-container { grid-template-columns: 1fr; } /* スマホでは縦並びに戻す */
      .result-name-large { font-size: 3.5rem; }
      .final-image-container { width: 250px; height: 250px; }
    }
  </style>
</head>
<body>

  <!-- Header (LPと共通) -->
  <header>
    <!-- ロゴクリックで index.html (LP) に戻る -->
    <div class="logo" onclick="location.href='index.html'">efflo<span class="logo-dot">.</span></div>
    
    <!-- ハンバーガーメニュー -->
    <div class="hamburger" onclick="toggleMenu()">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </header>

  <!-- モバイルメニューオーバーレイ -->
  <div class="menu-overlay" id="menu-overlay">
    <a href="index.html" class="menu-link" onclick="closeMenu()">TOP</a>
    <a href="#" class="menu-link" onclick="closeMenu(); location.reload();">CHECK MODE</a>
    <a href="#" class="menu-link" onclick="closeMenu()">ABOUT</a>
  </div>

  <div class="container">

    <!-- 1. 質問セクション -->
    <section id="question-section">
      <h2 class="page-title">Check Your Mode</h2>
      <p class="page-desc">今の状態に近いものを直感で選んでください。</p>

      <form id="diagForm">
        <!-- Q1 -->
        <div class="question-card">
          <div class="question-text"><span class="q-num">Q1.</span> 今、あなたのエネルギー量は？</div>
          <div class="options">
            <label><input type="radio" name="q1" value="1"> <span>ほとんどない（動きたくない）</span></label>
            <label><input type="radio" name="q1" value="2"> <span>低い（温存モード）</span></label>
            <label><input type="radio" name="q1" value="3"> <span>普通</span></label>
            <label><input type="radio" name="q1" value="4"> <span>高い（やる気がある）</span></label>
            <label><input type="radio" name="q1" value="5"> <span>爆発的（じっとしていられない）</span></label>
          </div>
        </div>

        <!-- Q2 -->
        <div class="question-card">
          <div class="question-text"><span class="q-num">Q2.</span> 気分はポジティブ？ネガティブ？</div>
          <div class="options">
            <label><input type="radio" name="q2" value="1"> <span>不快・重苦しい</span></label>
            <label><input type="radio" name="q2" value="2"> <span>やや曇っている</span></label>
            <label><input type="radio" name="q2" value="3"> <span>どちらでもない（フラット）</span></label>
            <label><input type="radio" name="q2" value="4"> <span>やや晴れやか</span></label>
            <label><input type="radio" name="q2" value="5"> <span>最高に心地よい</span></label>
          </div>
        </div>

        <!-- Q3 -->
        <div class="question-card">
          <div class="question-text"><span class="q-num">Q3.</span> 意識の方向は？</div>
          <div class="options">
            <label><input type="radio" name="q3" value="1"> <span>内面・作業に没入したい</span></label>
            <label><input type="radio" name="q3" value="2"> <span>少し距離を置きたい</span></label>
            <label><input type="radio" name="q3" value="3"> <span>どちらともいえない</span></label>
            <label><input type="radio" name="q3" value="4"> <span>他者の意見を聞きたい</span></label>
            <label><input type="radio" name="q3" value="5"> <span>周りを巻き込みたい・発信したい</span></label>
          </div>
        </div>

        <!-- Q4 -->
        <div class="question-card">
          <div class="question-text"><span class="q-num">Q4.</span> 状況は見えていますか？</div>
          <div class="options">
            <label><input type="radio" name="q4" value="1"> <span>混乱している</span></label>
            <label><input type="radio" name="q4" value="2"> <span>少し違和感がある</span></label>
            <label><input type="radio" name="q4" value="3"> <span>普通・理解している</span></label>
            <label><input type="radio" name="q4" value="4"> <span>明確に見通せている</span></label>
            <label><input type="radio" name="q4" value="5"> <span>新しい発見があった</span></label>
          </div>
        </div>

        <!-- Q5 -->
        <div class="question-card">
          <div class="question-text"><span class="q-num">Q5.</span> プレッシャーはありますか？</div>
          <div class="options">
            <label><input type="radio" name="q5" value="1"> <span>全くない</span></label>
            <label><input type="radio" name="q5" value="2"> <span>あまりない</span></label>
            <label><input type="radio" name="q5" value="3"> <span>適度な緊張感がある</span></label>
            <label><input type="radio" name="q5" value="4"> <span>強く感じている（焦り）</span></label>
            <label><input type="radio" name="q5" value="5"> <span>押しつぶされそう</span></label>
          </div>
        </div>

        <button type="button" id="submit-btn" onclick="calculateCandidates()">DIAGNOSE</button>
      </form>
    </section>

    <!-- 2. 選択セクション（上位2つを提示） -->
    <section id="selection-section">
      <h2 class="page-title">Select Your Vibe</h2>
      <p class="page-desc">あなたの状態に近いのはどっち？</p>
      
      <div class="candidates-container" id="candidates-container">
        <!-- JSでここにカードを挿入 -->
      </div>
      <button class="back-btn" style="margin-top:40px" onclick="location.reload()">RETRY</button>
    </section>

    <!-- 3. 最終結果セクション -->
    <section id="result-section">
      <p class="result-label">YOUR CURRENT MODE</p>
      
      <div class="final-image-container">
          <img id="final-image" src="" alt="Emotion Flower">
      </div>

      <h2 class="result-name-large" id="final-name">HYPE</h2>
      <div class="result-jp-large" id="final-jp">積極</div>
      
      <div class="result-desc" id="final-desc">解説文...</div>
      
      <button class="back-btn" onclick="location.reload()">CHECK AGAIN</button>
    </section>

  </div>

  <script>
    /* 感情データ定義 (画像は .png) */
    const emotions = [
      {
        id: "HYPE", jp: "積極", image: "efflo-01.png", color: "#FF2E93", // Hyper Pink
        vector: [0.9, 0.9, 0.9, 0.8], 
        desc: "エネルギーが溢れ、周囲を巻き込むポジティブな状態。\nリーダーシップを発揮できるタイミング。"
      },
      {
        id: "FLOW", jp: "集中", image: "efflo-02.png", color: "#304FFE", // Electric Blue
        vector: [0.8, 0.8, 0.2, 0.9], 
        desc: "一点に深く没入している状態。\n高い生産性を発揮するが、話しかけられたくないかも。"
      },
      {
        id: "LIKE", jp: "共感", image: "efflo-03.png", color: "#FFD600", // Sunny Yellow
        vector: [0.5, 0.9, 0.9, 0.7], 
        desc: "他者の意見を受け入れ、感動している状態。\n素晴らしい聞き手になれる。"
      },
      {
        id: "SPARK", jp: "驚き", image: "efflo-04.png", color: "#00E676", // Acid Green
        vector: [0.8, 0.7, 0.6, 1.0], 
        desc: "新しい発見やアイデアに衝撃を受けている状態。\nパラダイムシフトの瞬間。"
      },
      {
        id: "EDGE", jp: "緊張", image: "efflo-05.png", color: "#304FFE", // Electric Blue
        vector: [0.9, 0.3, 0.5, 0.4], 
        desc: "プレッシャーを感じているが、やる気はある崖っぷちの状態。\n良いパフォーマンスの予兆。"
      },
      {
        id: "MELT", jp: "消耗", image: "efflo-06.png", color: "#7C4DFF", // Mystic Purple
        vector: [0.1, 0.3, 0.3, 0.2], 
        desc: "エネルギーが枯渇し、思考が溶け出している状態。\n休息か、単純作業が必要。"
      },
      {
        id: "ERROR", jp: "不調", image: "efflo-07.png", color: "#1A1A2E", // Ink Black
        vector: [0.6, 0.2, 0.1, 0.1], 
        desc: "意欲はあるが、状況が整理できずフリーズしている状態。\n情報の整理が必要。"
      }
    ];

    // 計算ロジック
    function calculateCandidates() {
      const q1 = document.querySelector('input[name="q1"]:checked');
      const q2 = document.querySelector('input[name="q2"]:checked');
      const q3 = document.querySelector('input[name="q3"]:checked');
      const q4 = document.querySelector('input[name="q4"]:checked');
      const q5 = document.querySelector('input[name="q5"]:checked');

      if (!q1 || !q2 || !q3 || !q4 || !q5) {
        alert("すべての質問に答えてください。");
        return;
      }

      const vEnergy = (parseInt(q1.value) - 1) / 4;
      const vValence = (parseInt(q2.value) - 1) / 4;
      const vSocial = (parseInt(q3.value) - 1) / 4;
      
      let rawControl = (parseInt(q4.value) - 1) / 4;
      let pressure = (parseInt(q5.value) - 1) / 4;
      if (parseInt(q4.value) === 5) rawControl = 1.2; 

      const vControl = Math.max(0, Math.min(1, rawControl - (pressure * 0.3)));
      const finalValence = Math.max(0, Math.min(1, vValence - (pressure * 0.2)));
      const userVector = [vEnergy, finalValence, vSocial, vControl];

      const sortedEmotions = emotions.map(emo => {
        let dist = 0;
        for(let i=0; i<4; i++) {
          dist += Math.pow(userVector[i] - emo.vector[i], 2);
        }
        return { ...emo, distance: Math.sqrt(dist) };
      }).sort((a, b) => a.distance - b.distance);

      const top2 = sortedEmotions.slice(0, 2);

      // 画面遷移
      document.getElementById('question-section').style.display = 'none';
      const selectionSec = document.getElementById('selection-section');
      const container = document.getElementById('candidates-container');
      
      container.innerHTML = '';
      top2.forEach(emo => {
        const card = document.createElement('div');
        card.className = 'candidate-card';
        card.onclick = () => showFinalResult(emo);
        
        // 名前(英語)の色をその感情の色にする
        card.innerHTML = `
          <img src="${emo.image}" alt="${emo.id}" class="candidate-img">
          <div class="candidate-name" style="color: ${emo.color}">${emo.id}</div>
          <div class="candidate-jp">${emo.jp}</div>
        `;
        container.appendChild(card);
      });

      selectionSec.style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // 最終結果表示
    function showFinalResult(emotion) {
      document.getElementById('selection-section').style.display = 'none';
      const resultSec = document.getElementById('result-section');
      
      document.getElementById('final-image').src = emotion.image;
      
      const nameEl = document.getElementById('final-name');
      nameEl.innerText = emotion.id;
      nameEl.style.background = 'none';
      nameEl.style.webkitTextFillColor = 'initial';
      nameEl.style.color = emotion.color; // メインカラーを適用

      document.getElementById('final-jp').innerText = emotion.jp;
      document.getElementById('final-desc').innerText = emotion.desc;

      resultSec.style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ハンバーガーメニュー制御
    function toggleMenu() {
      const burger = document.querySelector('.hamburger');
      const menu = document.getElementById('menu-overlay');
      burger.classList.toggle('open');
      menu.classList.toggle('open');
    }

    function closeMenu() {
      const burger = document.querySelector('.hamburger');
      const menu = document.getElementById('menu-overlay');
      burger.classList.remove('open');
      menu.classList.remove('open');
    }
  </script>
</body>
</html>
